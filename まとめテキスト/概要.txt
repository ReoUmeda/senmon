HTTP/2によるWebの変化
1.昨今のウェブの状況
最近のWebサイトではWebサーバとブラウザ間でやり取りをしなければならないデータの量が増えてきている。
そのためページ全体が表示されるのに遅くなってしまう。複数のコネクションを同時に使いデータを早く送る
方法が存在するがサーバやクライアントの付加を増やしてしまい余計に遅くさせてしまう可能性がある。また、
あるHTTPのリクエストに対する応答が遅くなっていると、後続の応答まで全てブロックされるというHTTP/1.1
の仕様もあり、コネクション数を増やしても効果が得られないことがある。
2. HTTPの歴史
　HTTPは1990年ごろCERNのティム・バーナーズ・リー氏がHTMLと共にCERN内の情報にアクセスするために設計
をした。HTTP/0.9はURLのみの簡単なやり取りだったがその後1996年にHTTP/1.0の仕様が公開されそれにはSMTP
のような各種ヘッダが追加され1999年に公開されたHTTP/1.1は複数のデータを効率よく転送するための持続的
接続やプロキシの利用等を想定した仕様になっていた。

3. HTTP/2の仕様
HTTP/2では実質的な転送速度を向上させることを目的としている。そのために通信路を仮想的に多重化して
素早いレスポンスを実現しつつ，データ圧縮で送信するデータを少なくしている。またHTTP/1.1との互換性を
維持しつつ求められる要求をSPDYを元に作られていてまずHTTP/1.1で通信をしてその後両方がHTTP/2に対応し
ているとHTTP/2による通信に移行する。
具体的に高速化はコマンドやパラメーターの送信データを「フレーム」というバイナリ形式で送信するように
なりフレームでHTTP/2はやり取りをするようになっている。そのようにすると小さな容量で転送ができ
テキストプロトコルとは違い空白の処理などがなく決まりきった形になっているため解析がしやすくなっている。
また「ストリーム」という仮想的な通信路を作りそれを使い双方向に「フレーム」を送受信する。
1つのコネクションで複数のストリームを作るとHTTP/1.1での複数のコネクションを使ったのと同等以上やり取り
が出来，ルーターやファイアウォール、プロキシサーバなどのネットワーク全体に対する負担が少なくなる。
そのためHTTP/1.1とは違いクライアントとサーバ間のコネクションは1つだけにしたほうが良いようになっている。
HTTP/1.1でも「パイプライン」機能を使えば、1つのコネクションで複数のリクエストを連続して送信することが
可能だったが、その場合は、レスポンスは送信したリクエスト順になる。だがHTTP/2のストリームではレスポンス
の順番を変更できるので、例えばサーバ側の処理が重い場合は、それ以外の軽い処理のレスポンスを先に返す、
といったことが可能になる。
ストリームには「優先度」を指定することもでき、後から緊急度の高いリクエストを送って、その結果を先に返す
ように要求することもできる優先度制御がある。
　HTTP/2では通信の状態を制御する機能として、「フロー制御」 機能も用意されている。一度に送信可能な
データ量を抑制して受信側のバッファーがあふれてリソース不足になるのを防いだり、逆に大きなウィンドウサイズ
を 指定して、巨大なデータを効率よく送信させたりできる。HTTP/1.1ではTCP/IPのプロトコルスタックに含まれる
ウィンドウ制御に依存していたが、HTTP/2ではWebサーバやアプリケーションがある程度制御できるようになる。
　HTTP/2では、より信頼性の高いエラー処理ができるようになっている。 HTTP/1.1ではエラーが発生した場合、
サーバがそのリクエストを受け付けて処理したのか、それとも単にリクエストが届いていないのか、
などを区別する方法がなかった。処理内容によっては、リクエストを再送して再実行すると不具合を起こすものもあり、
注意してシステムを設計する必要がある。HTTP/2では、ストリームを使うことにより、どのストリーム番号の処理まで
完了したかをクライアント側から確実に確認できるようになっており、より信頼性の高いシステムを構築できる。
　HTTPのリクエストとレスポンスには、「HTTPヘッダー」と呼ばれるテキストデータが含まれている。
この部分は長さがある割には決まった文字列も多く、また連続する複数のHTTPヘッダーを観測して比較すると、
その差が少ないことが多い。そこで、このHTTPヘッダー部分を圧縮できれば通信データの削減につながり、
もし1ページが約80個のアセットで構成されており、各リクエストが1400byteのヘッダーを持つと仮定すると
ヘッダーの送出だけで7-8ラウンドトリップが必要となってしまうため圧縮することによりパケットの数を減らすこと
になりラウンドトリップが減るためパフォーマンスの向上が期待できる。HTTP/2では「HPACK」という方法が採用されている。
サーバプッシュによるデータ送信によってWebサーバ側からWebブラウザに対して、あらかじめ必要となるデータを送信
しておく機能でありブラウザにページを表示をするために必要な画像などを送ることによりラウンドトリップを減らす
ことが出来る。

4.HTTP/2今後
HTTP/2を使うためにはサーバ側とブラウザ側の両方が対応していく必要があるが主要ブラウザの最新バージョンは
HTTP/2に対応しており「Windows10」の「Internet Explorer 11」、「Firefox 36」、「Chrome 40」などがある。
HTTP/2はまだIETFに承認されてRFCとして文章化されている最中でありHTTP/1.1に最適化されていると単にHTTP/2に
変えるだけではページの表示は遅くなる可能性もありまだHTTP/2の恩恵を受けるためには時間がかかる。




http://www.atmarkit.co.jp/ait/articles/1409/18/news135.html
http://japan.zdnet.com/article/35061196/
http://http2.info/faq.html#why-revise-http
http://ja.wikipedia.org/wiki/Hypertext_Transfer_Protocol
http://ja.wikipedia.org/wiki/%E3%83%86%E3%82%A3%E3%83%A0%E3%83%BB%E3%83%90%E3%83%BC%E3%83%8A%E3%83%BC%E3%82%BA%EF%BC%9D%E3%83%AA%E3%83%BC#cite_note-proposal-4
http://ja.wikipedia.org/wiki/Hypertext_Transfer_Protocol
